### Лекция по теме "09.03 CI\CD"

### CI\CD
Алексей
Метляков

### 1Алексей Метляков
DevOps Engineer
OpenWay
Алексей Метляков


### 2План занятия
1. Continuous Integration
2. Test
3. Build
4. Merge
5. Continuous Delivery
6. Release
7. Test
8. Continuous Deploy
9. Deploy to Prod
10. Feedback
11. Итоги
12. Домашнее задание

### 3Continuous Integration

### 4Continuous Integration
CI (Continuous Integration, непрерывная интеграция) – этап
непрерывной поставки продукта, который отвечает за непрерывную
сборку кода разработчиков.
Условно, его можно разделить на следующие подэтапы:
- Build – сборка;
- Test – тестирование;
- Merge – слияние.

### 5Continuous Integration
Orchestrator
Push Linting
Clone Building
Merge SCM
Testing

### 6Continuous Integration
- Jenkins / Teamcity /
- Gitlab CI
- Bitbucket
- Github
- Gitlab
- SonarQube / Gradle
- Maven
- Mercurial
- (SCM)

### 7Continuous Integration
SonarQube – отдельный сервис для статического анализа кода
(линтер).
Особенностью является возможность анализа разных языков
программирования.
- Существует CE (с урезанным функционалом)
- Есть возможность купить лицензию с поддержкой

### 8Continuous Integration
Сборщики – программы, которые позволяют:
- собрать все зависимости, необходимые для компиляции кода;
- произвести сборку кода;
- запустить unit-тесты;
- сделать тестовый запуск продукта.
Примеры сборщиков:
- Gradle
- Maven

### 9Continuous Integration
**Merge** – процесс объединения текущей ветки разработчика с
основной (или релизной) веткой в репозитории.

- 00:37:20 - что такое  система Сонар. 
- 00:37:30 - Про ДЗ

- 00:47:10 - про интеграцию Сонар с системами контроля версий.
- 00:47:50 - обзор интерфейса
- 00:48:18 - Rules. пояснение по меню Rules. Здесь лежит список тех языков программирования, которые можно проверить на ствтический анализ и те правила, котрыми статический анализ кода производится.
- 00:51:10 - QualityProfile группировка Rules в профайлы
- 00:53:40 - QualityGAte - это метрики, которые делают оценку написанного кода
- 00:55:30 - создание нового профайла для QualityGAte
- 00:56:40 - пояснение про Rules, QualityProfile, QualityGAte
- 00:56:50 - Подготовка SonarQube к работе. Скачивание дистрибутива. 
- 01:00:40 - добавление в env путь до sonar-scaner 
- 01:02:10 - как тестировать код
- 01:13:35 - показано как могут быть протестированы разные ветки системы контроля версий
- 01:14:20 - резюме по Сонару


### 10Continuous Delivery  CDL   01:14:55

### 11Continuous Delivery
CD (Continuous Delivery, непрерывная доставка) – этап
непрерывной поставки продукта, который отвечает
за компиляцию дистрибутива продукта, установку продукта
на тестовые среды и проведение тестирования.
Его тоже можно поделить на подэтапы:
- Compile – компиляция
- Release – релиз
- Deploy – установка
- Test – тестирование

### 12Continuous Delivery     01:17:05

Схема с точик зрения процессов
* Orchestrator - основная программа 
* Push, Clone, Merge - передаем  исходный код на Orchestrator
* Затем Orchestrator триггерит проверку Linting, компиляцию Compile и тесты Testing. Обезопасим себя
* Затем Orchestrator триггерит сборку для того чтобы выложить дистрибутив в хранение Storage, потом его задеплоить Deployment, и протестировать Testing
  - Orchestrator может быть один и тот же или могут быть разные для разных этапов CD. Например, Jenkins, или Teamcity

  
  
  

### 13Continuous Delivery     01:19:00
Схема с точик зрения инструментов:

* Jenkins / Teamcity / Gitlab CI - оркестраторы
* Bitbucket Github Gitlab Mercurial (SCM) - хранилище кода или что-то похожее
* SonarQube Gradle Maven - для сборки и тестирования кода
sonatype nexus, jfrog artifactory - хранилище артифактов
* Ansible - чтобы раздеплоить что-то куда-то. А также это может быть Docker, Helma,  Qebrnetis, Puppet, Chef. Т.е любое, что может что-то куда-то развернуть наш заготовленный дистрибутив, архив. Это потом еще нужно и автотестами обложить, например системой HP ALM. Это похоже на SonarQube, только для автотестов или для тестов в целом. Для того чтобы тесты менеджерить.
* Selenium - система and-to-and тестирования
- 01:21:23 - подробнее про Selenium. Функциональный тесть работы сайта (переходы, нажатие кнопок). Аналог поведения пользователя. Нужно только описать действия - куда что писать, в какие поля добавить информацию, какие кнопки и когда нажимать. Проверку изменения свойств объектов (смену цветов)




### 14Continuous Delivery     01:25:25
Nexus - один из способов хранить артефакты (релизы, зависимости, библиотеки etc) и использовать их в процессах DevOps.
При его помощи можно:
- Хранить и версионировать артефакты
- Разделять разные виды артефактов по разным типам репозиториев
- Доставлять артефакты по всей инфраструктуре
- Использовать разные механизмы разрешения зависимостей

- 01:26:10 - позволяет делать различные репозитории для хранения артифактов, скачивать и хранить зависимости для организации локального хранилища.  Можно хранить Docker контейнеры. Все это можно версионировать, он их будет красивао складывать. Разделять по типам репозиториев, а не складывать в одну кучу. Затем доставлять это все по инфраструктуре, доступной Nexus
- 01:27:00 - запуск Nexus
- 01:27:00 - подключение к ранее запущенному нашему Nexus
- 01:36:35 - вручную в Nexus не аплоадят. ИСпользуют Maven, Gredl и прочее

### 15Continuous Delivery     01:23:28 
Selenium - инструмент для проведения E2E-тестирования
работоспособности web-продуктов.
При его помощи можно:
- Проводить тестирования интерфейсов
- Указывать ожидаемый результат обработки нажатий и сравнивать с полученным результатом
- Записывать ролики прохождения тестирования

- 01:24:30 - производная от Selenium - Selenoid позволяет браузеры поднимать в контейнерах и управлять Селениум запуски внутри этих контейнеров

### 16Continuous Deployment  CDP   01:54:10

### 17Continuous Deployment     01:54:55
CD (Continuous Deployment, непрерывная установка) – этап
непрерывной поставки продукта, который отвечает за установку
дистрибутива продукта на продакшн окружение.
Иногда он не является этапом CI\CD, поэтому его появление
опционально, но для полноценного конвейера и выполнения
условий непрерывного цикла он необходим.

### 18Continuous Deployment     01:57:05
С точки зрения процессов
* Orchestrator:
* Storage -> Deployment -> Production

### 19Continuous Deployment     01:57:30
С точки зрения приложений:
* Orchestrator: Jenkins / Teamcity / Gitlab CI



* Storage -> sonatype / nexus / jfrog / artifactory
* Deployment ->  Ansible / Docker    Забудьте: SonarQube/ Gradle/ Maven
* Production ->  Puppet / Chef /  
 

### 20Continuous Deployment     01:58:56
Установкой может считаться:
- прогон плейбуков Ansible,
- запуск Docker-контейнера с образом.
Важно понимать, что администратор промышленной части,
может, и будет проводить ручную проверку установленной
версии продукта.

### 21Continuous Deployment     02:01:05
Feedback – сбор обратной связи от клиентов (в том числе и
внутренних) о продукте в виде багов и новых story.
Важно помнить:
- ошибки являются нормой,
- даже на проде,
- ошибки являются ценностью,
- их необходимо правильно обработать,
- их необходимо правильно проанализировать,
- они требуют исправлений не меньше, чем внедрение новых фич.

### 22Итоги

### 23Итоговая схема      02:04:50

```
                                                   
                                                  
-->  Developer -> Git -> Jenkins / Teamcity / Gitlab CI -> SonarQ 
\                                                 \
  \                                                 \ --> Gradle ---- > Dev (стенд разработчиков). По-хорошему у разработчиков должен быть свой стенд.
    \                                                 \           \
      \                                                \           \-> Nexus / Artifactory
        \                                                \                                 \
          \                                                \                                 \-> Docker  \______/---->  Prod --->\
            \                                                \                                \            \-->/---/->  Test      \
              \                                                \                               \-> Ansible /      /               /
                \                                                \-> Selenium -> ________________________________/               /
                  \___<________________________________________________________________________________________________<_______/
                     
```

### 24Итоги     02:09:50
- CI\CD-процессы отвечают за непрерывность конвейера
производства программного продукта;
- На каждом из этапов в разных командах могут использовать
разный набор инструментов;
- Набор наших задач, как специалистов может быть
разнообразный:
  - поддержка инструментов DevOps,
  - поддержка взаимодействия (автоматизация конвейера),
  - поддержка отдельных этапов (CI, CDL, CDP),
  - внедрение и поддержка процессов DevOps,
  - все вышеперечисленные задачи сразу.

### 25Домашнее задание      02:14:20
Давайте посмотрим ваше домашнее задание.
- Вопросы по домашней работе задавайте в чате мессенджера Slack.
- Задачи можно сдавать по частям.
- Зачёт по домашней работе проставляется после того, как приняты все задачи.

### 26Задавайте вопросы и
пишите отзыв о лекции!
Алексей Метляков
Алексей Метляков
