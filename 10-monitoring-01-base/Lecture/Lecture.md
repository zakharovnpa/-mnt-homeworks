### Лекция по теме "Зачем и что нужно мониторить"

Зачем и что нужно мониторить
Сергей
БывшевСергей Бывшев
Ведущий инженер автоматизации в "Метр
квадратный"
Сергей Бывшев

### 2План занятия
1. Что такое мониторинг
2. Зачем нужен мониторинг
3. Типы мониторинга
4. Деление мониторинга по доменам ответственности
5. Подходы при настройке мониторинга
6. Подходы при настройке мониторинга: SRE
7. Подходы при настройке мониторинга: логи не нужны
8. Итоги
9. Домашнее задание

### 3Что такое мониторинг?

### 4Что такое мониторинг?
Мониторинг - это сбор, обработка,
агрегирование и отображение в
реальном времени количественных и
качественных показателей системы.
Мониторинг позволяет улучшать,
либо оставлять на приемлемом
уровне качество обслуживания
пользователей.
Взято с сайта: unsplash.com

### 5Что такое мониторинг?
На практике мониторинг чаще всего включает в себя:
● Оценку работоспособности ПО. Например, количество успешных
ответов http-сервера.
● Оценку работоспособности оборудования. Например, средняя
загрузка ЦПУ за 5 минут.
● Бизнес мониторинг. Например, мониторинг движения финансовых
средств.
● Мониторинг безопасности ИС. Например, мониторинг актуальности
каких-либо сертификатов.

### 6Зачем нужен мониторинг

### 7Зачем нужен мониторинг
● Анализ долгосрочных тенденций. Получение качественных
характеристик в обеспечение дальнейшей работоспособности системы.
Например размер БД и его близость к критическим значениям.
● Сравнение версий ПО. Насколько изменения ПО повлияли на качество
обслуживания.
● Оповещение. Превентивное выявление возможных отклонений в
качестве обслуживания и увеличение скорости реакции на сбои.
● Телеметрия текущей работоспособности приложения. Получение
текущей оценки характеристик информационной системы в режиме
real-time.
● Ретроспективный анализ, Выявление узких мест информационной
системы на основе полученных ранее данных мониторинга.

### 8Типы мониторинга
### 9Типы мониторинга
Чаще всего мониторинг разделяют на 2 типа:
● White-box monitoring. Наблюдение за
системой “изнутри”. Сбор данных
профилирования, логов, системные журналы.
● Black-box monitoring. Наблюдение, видимое
извне. Например сбор возникших ошибок
системы технической поддержкой или
отделом тестирования.
### 10Типы мониторинга
Для DevOps-подхода важнее white-box
мониторинг, так как только он позволяет
спрогнозировать поведение системы и
исправить проблемы до их возникновения.
Но про black-box мониторинг тоже не стоит
забывать. Это “симптоматическая”
диагностика, которая позволяет выявить
редкие кейсы поломок системы.

### 11Деление мониторинга по
доменам ответственности

### 12Деление мониторинга по доменам
ответственности
Домены ответственности мониторинга можно разделить
по системам сбора метрик:
● Система сбора временных рядов. Prometheus, Inﬂuxdb.
● Система сбора логов. ELK.
● Система перехватчик-ошибок. Sentry.

### 13Деление мониторинга по доменам
ответственности
Системы сбора временных рядов
позволяют получать телеметрию в
режиме реального времени и хранить
данные в таблицах в виде “метка-
времени - значение”.
Такие системы нужны для
непрерывного наблюдения за
изменением в работоспособности
системы.
Пример метрики - доступное место на
файловой системе

### 14Деление мониторинга по доменам
ответственности
Основные метрики для мониторинга
в системах временных-рядов:
● CPU LA.
● RAM/swap
● IOPS
● inodes
● FS
Взято с сайта: unsplash.com

### 15Деление мониторинга по доменам
ответственности
Дополнительные метрики для
мониторинга в системах
временных-рядов:
● Process liveness
● IOwait
● Net trafﬁc
● Custom?
Взято с сайта: unsplash.com

### 16Деление мониторинга по доменам
ответственности
Системы сбора логов позволяют агрегировать логи приложений,
системные журналы и т.п.
Такие системы чаще всего нужны для детального разбора
появившихся проблем, нахождения их частоты появления,
разбора поведения системы в каких-то условиях.
Пример - логи балансировщика запросов.

### 17Деление мониторинга по доменам
ответственности
Взято с сайта: elastic.co

### 18Деление мониторинга по доменам
ответственности
Системы “Перехватчик ошибок” позволяют информировать о
возникающих ошибках ПО в режиме real-time.
При этом для этой системы можно указать дополнительные
характеристики, которые будут в информировании.
Например:
● Слой (stage/production).
● Hostname.
● Номер реплики приложения.
● Внутреннее состояние приложения.

### 19Деление мониторинга по доменам
ответственности
Взято с сайта: docs.sentry.io

### 20Деление мониторинга по доменам
ответственности
Основные метрики для мониторинга в системах
сбора логов и ловли ошибок:
● Good events/All events
● Trafﬁc

### 21Подходы при настройке
мониторинга

### 22Подходы при настройке мониторинга
Приведенные подходы не являются формальными и не будут тем
самым “золотым молотком”, который решит все проблемы.
Но желательно эти подходы знать и использовать в своей
деятельности по необходимости.
Они позволяют экономить на ресурсах, выделенных для
мониторинга, связать мониторинг с бизнес частью и улучшить
качественную интерпретацию полученных метрик.

### 23Подходы при настройке
мониторинга: SRE

### 24Подходы при настройке мониторинга: SRE
Данный подход разработан компанией
google и повсеместно внедряется в
компаниях по всему миру.
Подход SRE покрывает большинство
задач DevOps, в т.ч. задачи
мониторинга.
Один из его главных плюсов - он
сделан практикующими инженерами
для практикующих инженеров, на
основе многолетнего опыта.
Взято с сайта: landing.google.com

### 25Подходы при настройке мониторинга: SRE
Основные тезисы подхода при настройке мониторинга:
● Ставим для мониторинга реальные задачи.
● Система мониторинга должна отвечать на два вопросы:
что сломалось? почему сломалось?
● Используйте четыре золотых сигнала.
● Не исследуйте только средние значения.
● Выберите подходящий уровень детализации.

### 26Подходы при настройке мониторинга: SRE
Четырьмя золотыми сигналами в подходе SRE называются:
● Время отклика. Время, которое требуется для выполнения запроса.
● Величина трафика. Величина нагрузки, которая приходится на вашу
систему. Например для веб - это количество http запросов, а для
потокового аудио - это скорость передачи данных.
● Уровень ошибок. Количество или частота неуспешно выполненных
запросов. Например ответ 500 от http сервера.
● Степень загруженности. Показатель того, насколько полно загружен
ваш сервис. Это мониторинг компонентов, которые покажут
загруженность вашего сервиса. Например для вычислений - это ЦПУ.
Для In-memory БД - это RAM.

### 27Подходы при настройке мониторинга: SRE
Кроме golden-signals также существуют такие важные метрики,
как:
● SLO. Целевой уровень качества обслуживания. Целевое
значение или диапазон значений.
● SLA. Соглашение об уровне обслуживания. Явный или
неявный контракт с внешними пользователями, включающий
в себя последствия невыполнения SLO.
● SLI. Индикатор качества обслуживания. Конкретная величина
предоставляемого обслуживания.

### 28Подходы при настройке мониторинга: SRE
Метрики SLO/SLA/SLI позволяют связать измеряемые “технические”
значения с бизнес составляющей.
Пример простого SLA:
Если наш сайт отдает http коды 4хх/5xx, то мы должны произвести
денежную компенсацию пользователю, если это не запланированное
техническое обслуживание.
Пример SLO:
В 99% случаев мы должны отдавать http коды отличный от 4xx/5xx. 1%
выделяется на техническое обслуживание.
Расчет SLI может выглядеть таким образом:
SLI = (summ_2xx_requests + summ_3xx_requests)/(summ_all_requests)

### 29Подходы при настройке
мониторинга:
логи не нужны

### 30Подходы при настройке мониторинга:
Логи не нужны
Данный подход предложен компанией “Яндекс”
на DevOpsConf 2019.
Формулируется данный подход следующим образом:
“Достаточно создать инфраструктуру доставки полезных
метрик и данных вокруг сервисов. В результате появятся
полезные метрики, которые говорят о сервисах, и прозрачно
показывают все, что с ними происходит.”

### 31Подходы при настройке мониторинга:
Логи не нужны
Основные тезисы данного подхода:
● Логи в сыром виде бесполезны, но их можно
превратить в полезные метрики.
● Ошибки должны содержать контекст самой ошибки.

### 32Итоги

### 33Итоги
Мониторинг - неотъемлемая часть обеспечения качества
информационных систем.
Мониторинг должен:
● Отвечать на вопросы “Что случилось?” и “Почему?”.
● Быть достаточно простым.
● Иметь подходящий уровень детализации
● Содержать в себе метрики, связанные с “бизнес” частью

### 34Домашнее задание      - 01:17:00
Давайте посмотрим ваше домашнее задание.
● Вопросы по домашней работе задавайте в чате мессенджера Slack.
● Задачи можно сдавать по частям.
● Зачёт по домашней работе проставляется после того, как приняты
все задачи.

### 35Задавайте вопросы и
пишите отзыв о лекции!
Сергей Бывшев
Сергей Бывшев
