# Домашнее задание к занятию "10.06. Инцидент-менеджмент" - Захаров Сергей Николаевич

## Задание 

Составьте постмортем, на основе реального сбоя системы Github в 2018 году.

Информация о сбое доступна [в виде краткой выжимки на русском языке](https://habr.com/ru/post/427301/) , а
также [развёрнуто на английском языке](https://github.blog/2018-10-30-oct21-post-incident-analysis/).

**Ответ:**
1. Краткое описание инцидента (краткая выжимка о инциденте)

Из-за кратковременного отсутствия связи между Восточным и Западным ЦОД кластеры БД стали содержать различные данные за период отсутствия связи (43 секунды). После возобновления связи кластеры БД для восстановления целостности БД начали процесс репликации с Восточного ЦОД на Западный и с Западного ЦОД на Восточный. Это привело к высокой нагрузке на каналы связи, повышенной задержке при передаче данных (латентности) и непредсказуемому времени восстановления целостности БД из-за режима перерепликации. Для преодоления данной ситуации была выполнена временная приостановка функции записи новых данных в БД, что снизило трафик репликации и снизило латентность. В ручном режиме из резервных копий были восстановлены данные в Восточном ЦОД. Затем включен режим репликации с Западным ЦОД. Когда доступность сайта восстановилась до нормы, включен режим записи новых данных и восстановлены все сервисы сайта.

2. Предшествующие события (что произошло перед инцидентом)

Вышло из строя оптическое оборудование 100G в Восточном ЦОД. При проектировании топологии кластера было отсутсвие условий для резервирования сетевого оборудования в ЦОД.

3. Причина инцидента (из-за чего возник инцидент)

Пропала связь с сетевым концентраторм Восточного ЦОД. Отсутствие оборудования для резервирования затронутой аварией линиии связи.

4. Воздействие (на что повлиял инцидент)

Произошло разделение записей в БД сайта. Восточный ЦОД и Западный ЦОД стали содержать различные данные.

5. Обнаружение (когда и как инцидент был обнаружен)

Внутренние системы мониторинга генерировали предупреждения, указывающие на многочисленные сбои в системах. Иженеры группы быстрого реагирования определили, что топологии многочисленных кластеров баз данных находятся в непредвиденном состоянии. 

6. Реакция (кто ответил на инцидент, кто был привлечен, какие каналы коммуникации были задействованы)

Инженеры, участвующие в группе реагирования на инциденты, начали разработку плана по устранению несоответствий данных и внедрению наших процедур аварийного переключения для MySQL.
К решению проблемы присоединился координатор инцидента.
Были вызваны дополнительные инженеры из группы разработки баз данных GitHub. 
В блоге были сообщения для пользователей о статусе сайта и планируемом времени восстановления полной работоспособности всех сервисов сайта.

7. Восстановление (описание действий по устранению инцидента и поведение системы)



8. Таймлайн (последовательное описание ключевых событий инцидента с указанием времени)

* 2018 21 октября 22:52 UTC
> Из-за кратковременного отсутствия связи между Восточным и Западным ЦОД кластеры БД начали процесс репликации для восстановления целостности БД.
> Резко увеличился трафик между ЦОД и повысилась дополнительная задержка в передаче данных между ЦОД.

* 2018 21 октября 22:54 UTC
> системы мониторинга начали генерировать предупреждения, указывающие на многочисленные сбои в наших системах

* 2018 21 октября 23:02 UTC
> Инженеры нашей группы быстрого реагирования определили, что топологии многочисленных кластеров баз данных находятся в непредвиденном состоянии.
> Несколько инженеров отвечали и работали над сортировкой входящих уведомлений.

* 2018 21 октября 23:07 UTC
> Отвечающая команда решила вручную заблокировать наш внутренний инструмент развертывания, чтобы предотвратить внесение каких-либо дополнительных изменений. 

* 2018 21 октября 23:09 UTC 
> Команда респондентов поместила сайт в желтый статус . Это действие автоматически переводит ситуацию в активный инцидент и отправляет предупреждение координатору инцидентов. 

* 2018 21 октября 23:11 UTC 
> Присоединился координатор инцидента и через две минуты изменил статус решения на красный .

* 2018 21 октября 23:13 UTC
> Инженеры из группы разработки баз данных GitHub приступили к ручной настройке БД Восточного кластера в качестве основной для каждого кластера и перестройки топологии репликации. 
> А также они приостановили репликацию тех записей, которые не были реплицированы на Западное побережье, что предотвратило репликацию новых операций записи обратно на Восточное побережье. 
> Основание такого решения - невозможность справиться с **дополнительной задержкой**, возникающей из-за обмена данными между странами для большинства их вызовов базы данных. Это решение приведет к тому, что сервис станет непригодным для многих пользователей.

* 2018 21 октября 23:19 UTC
> Приостановлены сервисы доставки веб-перехватчика и сборки GitHub Pages для сохранения целостности данных.

* 22 октября 2018 г., 00:05 UTC
> Начало разработки плана по устранению несоответствий данных и синхронизации реплик на обоих сайтах.
> Обновлен статус сайта.
> Проинформировали пользователей о том, что планируется выполнить контролируемый переход на другой ресурс внутренней системы хранения данных.

* 22 октября 2018 г., 00:41 UTC
> Начало процесса резервного копирования для всех затронутых кластеров MySQL.
> Поиск решения для ускорения резервного копирования.

* 22 октября 2018 г., 06:51 UTC
> Завершение восстановление некоторых кластеров из резервных копий в Восточном ЦОД и начало репликации с Западным ЦОД.
> Изменение статуса сайта "ожидаемое время восстановления - два часа"

* 22 октября 2018 07:46 UTC
> Опубликование сообщения в блоге для подачи актального окнтента пользователям.

* 22 октября 2018 г., 11:12 UTC
> Установление всех первичных БД на Восточном ЦОД
> Повышение отзывчивости сайта
> Распределение нагрузки чтения по большому пулу реплик чтения

* 22 октября 2018 г., 13:15 UTC
> Начало предоставления дополнительных реплик чтения MySQL в общедоступном облаке Восточного ЦОД для сокращения совокупного использования реплик

* 22 октября 2018 г., 16:24 UTC
> Выполнено аварийное переключение на исходную топологию.

* 22 октября 2018 г., 16:45
> Корректировка TTL веб-перехватчиков для предотвращения удаления полезных нагрузок веб-перехватчиков.
> Сохранение красного статуса сайта.

* 22 октября 2018 23:03 UTC
> Все ожидающие сборки вебхуков и страниц были обработаны, и была подтверждена целостность и правильная работа всех систем. 
> Статус сайта был обновлен до зеленого.


9. Последующие действия (что нужно предпринять, чтобы инцидент не повторялся)

---

### Как оформить ДЗ?

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

---

